<!-- index.html in /apps/gas -->
<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <title>DAWSheet Song Library</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f7fafc; padding: 1rem; color: #2d3748; }
    .container { max-width: 100%; }
    button { transition: all 0.2s ease-in-out; border-radius: 0.5rem; }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    select { border-radius: 0.5rem; }
    .status-message { padding: 0.75rem; margin-top: 1.5rem; border-radius: 0.5rem; font-size: 0.9rem; font-weight: 600; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .status-success { background-color: #4CAF50; color: white; }
    .status-error { background-color: #f44336; color: white; }
    .status-info { background-color: #2196F3; color: white; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container mx-auto p-4 bg-white rounded-lg shadow-md">
    <h1 class="text-2xl font-extrabold mb-5 text-gray-900 text-center">ðŸŽ¶ DAWSheet Song Library</h1>

    <div class="mb-6">
      <label for="songSelect" class="block text-gray-800 text-sm font-semibold mb-2">Select Song:</label>
      <select id="songSelect" class="shadow-sm border border-gray-300 rounded-lg w-full py-2.5 px-3 bg-white text-gray-800 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <option value="">-- Loading Songs... --</option>
      </select>
    </div>

    <div class="flex flex-col space-y-4">
      <button onclick="sendSelectedSongToTimeline()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-5 rounded-lg shadow-lg">Send to Timeline ðŸš€</button>
      <button onclick="loadSelectedSongIntoLiveSet()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-5 rounded-lg shadow-lg">Load Song into Live Set ðŸŽ§</button>
      <button onclick="showInfo('Panic / Reset functionality is not yet implemented in this module.')" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-5 rounded-lg shadow-lg">Panic / Reset ðŸ›‘</button>
    </div>

    <div id="statusMessage" class="status-message hidden mt-6"></div>
  </div>

  <script>
    const statusMessageDiv = document.getElementById('statusMessage');
    const songSelect = document.getElementById('songSelect');

    function showSuccess(message) {
      statusMessageDiv.textContent = message;
      statusMessageDiv.className = 'status-message status-success';
      statusMessageDiv.classList.remove('hidden');
    }
    function showError(error) {
      const errorMessage = error.message || String(error);
      statusMessageDiv.textContent = `Error: ${errorMessage}`;
      statusMessageDiv.className = 'status-message status-error';
      statusMessageDiv.classList.remove('hidden');
      console.error('Sidebar Error:', error);
    }
    function showInfo(message) {
      statusMessageDiv.textContent = message;
      statusMessageDiv.className = 'status-message status-info';
      statusMessageDiv.classList.remove('hidden');
    }
    function populateSongSelect(songs) {
      songSelect.innerHTML = '<option value="">-- Select a Song --</option>';
      if (songs && songs.length) {
        songs.forEach(song => {
          const opt = document.createElement('option');
          opt.value = song.songId; opt.textContent = song.title; songSelect.appendChild(opt);
        });
        songSelect.value = '';
      } else {
        songSelect.innerHTML = '<option value="">-- No Songs Found --</option>';
      }
      showInfo('Songs loaded. Select one to proceed.');
    }

    google.script.run
      .withSuccessHandler(populateSongSelect)
      .withFailureHandler(showError)
      .getSongsForSidebar();

    function sendSelectedSongToTimeline() {
      const selectedSongId = songSelect.value;
      if (!selectedSongId) { showError('Please select a song first.'); return; }
      showInfo('Generating commands and sending to timeline...');
      google.script.run
        .withSuccessHandler(showSuccess)
        .withFailureHandler(showError)
        .sendSelectedSongToTimeline(selectedSongId);
    }
    function loadSelectedSongIntoLiveSet() {
      const selectedSongId = songSelect.value;
      if (!selectedSongId) { showError('Please select a song first.'); return; }
      showInfo('Loading song references into Live Set...');
      google.script.run
        .withSuccessHandler(showSuccess)
        .withFailureHandler(showError)
        .loadSelectedSongIntoLiveSet(selectedSongId);
    }
  </script>
</body>
</html>
