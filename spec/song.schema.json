{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dawsheet.dev/spec/song.schema.json",
  "title": "DAWSheet Song Object v1",
  "type": "object",
  "required": ["v","meta","sections","arrangement"],
  "additionalProperties": false,
  "properties": {
    "v": {"const": 1},
    "meta": {
      "type": "object",
      "required": ["title","bpm","key"],
      "properties": {
        "title": {"type":"string"},
        "artist": {"type":"string"},
        "bpm": {"type":"number","minimum":1},
        "key": {"type":"string","description":"e.g., C, D#, Fm"},
        "mode": {"type":"string","description":"Ionian/Dorian/..."},
        "timeSignature": {"type":"string","pattern": "^\\d+/\\d+$"},
        "tags": {"type":"array","items":{"type":"string"}},
        "notes": {"type":"string"}
      },
      "additionalProperties": true
    },
    "sections": {
      "type": "array",
      "items": {"$ref":"#/$defs/section"}
    },
    "arrangement": {
      "type": "array",
      "items": {"$ref":"#/$defs/arrangementItem"}
    },
    "commands_ref": {
      "type":"array",
      "description":"Optional direct references to command groups/macros/scenes",
      "items":{"type":"string"}
    }
  },
  "$defs": {
    "section": {
      "type":"object",
      "required": ["name","length_bars"],
      "properties": {
        "name":{"type":"string","description":"Verse, Chorus, Bridge, etc."},
        "length_bars":{"type":"number","minimum":0},
        "chords":{"type":"array","items":{"$ref":"#/$defs/chord"}},
        "lyrics_ref":{"type":"string"},
        "notes":{"type":"string"}
      },
      "additionalProperties": true
    },
    "chord": {
      "type":"object",
      "required":["symbol"],
      "properties": {
        "symbol":{"type":"string","description":"e.g., Dm7, G7, Cmaj7"},
        "beats":{"type":"number","minimum":0.25},
        "roman":{"type":"string","description":"optional roman numeral"},
        "scale":{"type":"string","description":"optional scale/mode hint"}
      },
      "additionalProperties": false
    },
    "arrangementItem": {
      "type":"object",
      "required":["section","start_bar"],
      "properties": {
        "section":{"type":"string","description":"name must match a section.name"},
        "start_bar":{"type":"number","minimum":1},
        "repeat":{"type":"integer","minimum":1,"default":1},
        "scene_ref":{"type":"string","description":"optional DAWSheet scene id"},
        "macro_ref":{"type":"string","description":"optional DAWSheet macro id"}
      },
      "additionalProperties": false
    }
  },
  "examples": [{
    "v":1,
    "meta":{"title":"Demo Song","artist":"You","bpm":100,"key":"D","mode":"Dorian","timeSignature":"4/4","tags":["demo"]},
    "sections":[
      {"name":"Verse","length_bars":8,"chords":[{"symbol":"Dm7","beats":4},{"symbol":"G7","beats":4}]},
      {"name":"Chorus","length_bars":8,"chords":[{"symbol":"Cmaj7","beats":8}]}
    ],
    "arrangement":[
      {"section":"Verse","start_bar":1},
      {"section":"Chorus","start_bar":9,"repeat":2}
    ],
    "commands_ref":["scene:intro","macro:buildA"]
  }]
}